# Quest System v2.0 - Полный гайд для новичков (Editor Only)

> **Для кого этот гайд**: Для тех, кто впервые работает с квестами и хочет всё делать через Unreal Editor, без C++.

---

## ?? Содержание

1. [Подготовка проекта](#1-подготовка-проекта)
2. [Создание первого квеста](#2-создание-первого-квеста)
3. [Создание NPC с квестом](#3-создание-npc-с-квестом)
4. [Настройка UI для квестов](#4-настройка-ui-для-квестов)
5. [Тестирование](#5-тестирование)
6. [FAQ и решение проблем](#6-faq-и-решение-проблем)

---

## 1?? Подготовка проекта

### Шаг 1.1: Включить плагин Quest System

1. **Откройте Unreal Editor**
2. **Edit ? Plugins**
3. Найдите **"Quest System"** в поиске
4. ? Поставьте галочку **"Enabled"**
5. Нажмите **"Restart Now"**
6. Дождитесь перезапуска редактора

![Plugins Window](https://via.placeholder.com/800x400?text=Edit+%E2%86%92+Plugins+%E2%86%92+Quest+System+%E2%86%92+Enabled)

---

### Шаг 1.2: Настроить Asset Manager ?? КРИТИЧНО!

> **Без этого шага квесты НЕ БУДУТ РАБОТАТЬ!**

1. **Edit ? Project Settings**
2. Найдите **Game ? Asset Manager**
3. В разделе **"Primary Asset Types to Scan"** нажмите **+ Add**

Заполните поля:

```
???????????????????????????????????????????
? Primary Asset Type    ?
???????????????????????????????????????????
? Primary Asset Type: Quest           ? ? Название типа
? Asset Base Class: QuestAsset            ? ? Класс
? Has Blueprint Classes: ?    ? ? Галочка
?          ?
? Directories:        ?
?   [0]:      ?
?     Path: /Game/Quests           ? ? Где лежат квесты
?     Rules:       ?
?       - Priority: 1      ?
?       - Apply Recursively: ?    ?
???????????????????????????????????????????
```

4. Нажмите **"Save"**

![Asset Manager Setup](https://via.placeholder.com/800x400?text=Asset+Manager+Setup)

---

### Шаг 1.3: Создать структуру папок

1. В **Content Browser** создайте папки:

```
Content/
  ?? Game/
      ?? Quests/    ? Все квесты здесь
      ?   ?? Tutorial/        ? Обучающие квесты
      ? ?? Main/      ? Основные квесты
      ?   ?? Side/            ? Побочные квесты
      ?
      ?? Characters/
      ?   ?? NPCs/ ? Наши NPC
   ?
    ?? UI/
          ?? Quests/          ? Интерфейс квестов
```

2. **Готово!** Проект настроен ?

---

## 2?? Создание первого квеста

### Шаг 2.1: Создать Quest Asset

1. **Content Browser** ? папка `Content/Game/Quests/Tutorial`
2. **Right Click ? Quest System ? Quest Asset**
3. Назовите: `QA_FirstTalk` 
   - `QA` = Quest Asset (стандартное именование)
4. **Double Click** на созданный квест ? откроется редактор

![Create Quest Asset](https://via.placeholder.com/800x400?text=Right+Click+%E2%86%92+Quest+System+%E2%86%92+Quest+Asset)

---

### Шаг 2.2: Заполнить информацию о квесте

В редакторе квеста заполните:

#### **Metadata (Основная информация)**

```
???????????????????????????????????????????????
? METADATA         ?
???????????????????????????????????????????????
? Quest ID: Q_FirstTalk    ? ? Уникальный ID
? Quest Name: "Первый разговор"    ? ? Название
? Description: "Поговорите со старостой"      ? ? Описание
? Quest Giver ID: NPC_Elder   ? ? Кто даёт квест
? Icon: [Выберите иконку]         ? ? Иконка квеста
??
? Categories:          ?
?   - Tutorial ? ? Категория
?   - Dialogue    ?
?      ?
? Is Repeatable: ?        ? ? Можно повторять?
? Min Level: 1       ?
? Recommended Level: 1     ?
???????????????????????????????????????????????
```

> **?? Совет**: `Quest Giver ID` ДОЛЖЕН совпадать с ID NPC (настроим позже)!

---

### Шаг 2.3: Добавить Phase (Этап квеста)

1. В разделе **Phases** нажмите **+ Add**
2. Заполните:

```
???????????????????????????????????????????????
? PHASE 0        ?
???????????????????????????????????????????????
? Phase ID: Phase_Main        ? ? ID этапа
? Title: "Основной этап"      ?
? Description: "Поговорите со старостой"      ?
?    ?
? Require All Objectives: ?     ? ? Все цели обязательны
?           ?
? TRANSITION (Переход)           ?
? ?? Next Phase ID: [None]     ? ? После этого квест завершится
? ?? Auto Advance: ?   ? ? Автоматически
???????????????????????????????????????????????
```

---

### Шаг 2.4: Добавить Objective (Цель)

1. В **Phase 0 ? Objectives** нажмите **+ Add**
2. Заполните:

```
???????????????????????????????????????????????
? OBJECTIVE 0   ?
???????????????????????????????????????????????
? Objective ID: Obj_TalkToElder        ? ? ID цели
? Title: "Поговорите со старостой"        ? ? Что видит игрок
? Description: "Найдите и поговорите..."      ?
? ?
? Style: Talk         ? ? Тип задачи
? Is Optional: ?         ? ? Обязательная
? Is Hidden: ?           ? ? Видима игроку
?           ?
? COUNTERS (Счётчики)         ?
? ?? Target Count: 1            ? ? Сколько раз нужно
? ?? Allow Overcount: ?       ?
???????????????????????????????????????????????
```

---

### Шаг 2.5: Настроить условие выполнения

> **Это ВАЖНО!** Здесь мы говорим системе: "Засчитать задачу, когда игрок поговорит с NPC_Elder"

1. В **Objective 0 ? Conditions** нажмите **+ Add**
2. Заполните:

```
???????????????????????????????????????????????
? CONDITION 0          ?
???????????????????????????????????????????????
? Type: NpcTalked         ? ? Событие "поговорил с NPC"
?        ?
? String Param: NPC_Elder        ? ? ID NPC (ВАЖНО!)
? Int Param: 1       ? ? Сколько раз
? Float Param: 0.0    ?
?       ?
? Comparison: Equal       ? ? Когда >=1
???????????????????????????????????????????????
```

> **?? Важно**: `String Param: NPC_Elder` должен совпадать с ID вашего NPC!

---

### Шаг 2.6: Добавить награды

1. Прокрутите вниз до **Rewards On Complete**
2. Нажмите **+ Add** три раза для трёх наград:

#### Награда 1: Опыт

```
???????????????????????????????????????????????
? REWARD 0                   ?
???????????????????????????????????????????????
? Type: Stat     ? ? Тип: Характеристика
? Stat Name: Experience      ? ? Название
? Amount: 100             ? ? Сколько
? Operation: Add ? ? Добавить
???????????????????????????????????????????????
```

#### Награда 2: Золото

```
???????????????????????????????????????????????
? REWARD 1    ?
???????????????????????????????????????????????
? Type: Currency   ? ? Тип: Валюта
? Currency Name: Gold     ?
? Amount: 50       ?
???????????????????????????????????????????????
```

#### Награда 3: Тег (для отслеживания прогресса)

```
???????????????????????????????????????????????
? REWARD 2    ?
???????????????????????????????????????????????
? Type: Tag      ? ? Тип: Тег
? Tag: Quest.Tutorial.FirstTalk.Completed     ?
???????????????????????????????????????????????
```

3. **Ctrl+S** ? Сохранить квест
4. **Квест создан!** ?

---

## 3?? Создание NPC с квестом

### Шаг 3.1: Создать Blueprint NPC

1. **Content Browser** ? `Content/Game/Characters/NPCs`
2. **Right Click ? Blueprint Class ? Character**
3. Назовите: `BP_Elder` (Староста)
4. **Double Click** ? откроется Blueprint Editor

---

### Шаг 3.2: Добавить Quest Giver Component

1. В **Components** панели нажмите **+ Add Component**
2. Найдите **"Quest Giver Component"**
3. Выберите его ? появится в дереве компонентов

![Add Component](https://via.placeholder.com/800x400?text=Add+Component+%E2%86%92+Quest+Giver+Component)

---

### Шаг 3.3: Настроить Quest Giver Component

1. **Выберите** Quest Giver Component в списке
2. В **Details** панели справа найдите:

```
???????????????????????????????????????????????
? QUEST GIVER COMPONENT        ?
???????????????????????????????????????????????
? NPC ID: NPC_Elder ? ? ДОЛЖНО СОВПАДАТЬ с Quest!
? Auto Assign NPC ID: ?           ? ? Авто из имени
? ?
? Available Quests:       ?
?   [0]: QA_FirstTalk    ? ? Перетащите ваш квест
? ?
? Quest Icons:   ?
?   Quest Available Icon: [Иконка !]    ?
?   Quest Complete Icon: [Иконка ?]           ?
?   Quest In Progress Icon: [Иконка ...]      ?
???????????????????????????????????????????????
```

> **Как добавить квест**:
> 1. В поле `Available Quests` нажмите **+ Add**
> 2. Нажмите на выпадающий список
> 3. Найдите `QA_FirstTalk`
> 4. Выберите его

---

### Шаг 3.4: Добавить визуал NPC (опционально)

1. Добавьте **Skeletal Mesh** для модели NPC
2. Добавьте **Widget Component** для индикатора квеста над головой

```
Components:
  ?? BP_Elder
      ?? CapsuleComponent (root)
      ?? Skeletal Mesh (модель NPC)
      ?? Quest Giver Component ?
      ?? Widget Component (индикатор "!" над головой)
```

---

### Шаг 3.5: Настроить взаимодействие (Event Graph)

1. Перейдите в **Event Graph**
2. Добавьте событие взаимодействия:

#### Blueprint узлы:

```
???????????????????????????????????????????????????
? EVENT: Begin Play             ?
???????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Get Component by Class      ?
? Component Class: Quest Giver Component        ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? (Автоматически загрузит квесты при старте)   ?
?????????????????????????????????????????????????
```

#### Событие взаимодействия (когда игрок нажимает E):

```
???????????????????????????????????????????????????
? EVENT: On Interact          ?
? (Custom Event - создайте его) ?
???????????????????????????????????????????????????
  ?
    ?
?????????????????????????????????????????????????
? Get Quest Giver Component         ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Get Available Quests For Player          ?
? Player Controller: [Get Player Controller]    ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Branch (if Array Length > 0)        ?
?????????????????????????????????????????????????
    ?
    ?? TRUE ?? Open Quest Dialog Widget
    ?
    ?? FALSE ?? Play Default Dialogue
```

---

### Шаг 3.6: Интеграция с Dialog System

> **Если у вас уже есть Dialog System** (из ваших файлов)

1. Найдите Blueprint вашей диалоговой системы
2. В событии **On Dialog Started** добавьте:

```
???????????????????????????????????????????????????
? EVENT: On Dialog Started      ?
? NPC ID: [имя NPC]       ?
???????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Emit NPC Talked (Quest Blueprint Library)  ?
? ?? World Context: Self        ?
? ?? NPC ID: NPC_Elder        ?
? ?? Player: [Player Reference]       ?
? ?? Tags: [Empty]         ?
?????????????????????????????????????????????????
```

> **?? Это критически важно!** Без этого узла квест не засчитается!

**Где найти узел**:
- Right Click ? **Quest** ? **Emit NPC Talked**

---

## 4?? Настройка UI для квестов

### Вариант A: Простой Quest Tracker (HUD)

#### Шаг 4.1: Создать Widget

1. **Content Browser** ? `Content/Game/UI/Quests`
2. **Right Click ? User Interface ? Widget Blueprint**
3. Назовите: `WBP_QuestTracker`

---

#### Шаг 4.2: Дизайн виджета

Добавьте в **Designer**:

```
Canvas Panel
  ?? Vertical Box (Left alignment)
  ?? Text Block (Quest Title)
      ?   ?? Text: "Текущий квест"
      ?
      ?? Text Block (Objective Text)
        ?? Text: "Поговорите со старостой (0/1)"
```

**Настройка**:
- Назовите Text Block: `TextQuestTitle`
- Назовите Text Block: `TextObjective`

---

#### Шаг 4.3: Blueprint логика виджета

**Event Graph**:

```
???????????????????????????????????????????????????
? EVENT: Construct       ?
???????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Get Quest Subsystem (from World Context)     ?
?????????????????????????????????????????????????
    ?
 ?
?????????????????????????????????????????????????
? Get Progress Manager    ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Bind Event to On Objective Updated   ?
? Event: UpdateDisplay ?
?????????????????????????????????????????????????
```

**Function: UpdateDisplay**

```
???????????????????????????????????????????????????
? FUNCTION: Update Display        ?
? Inputs: Quest ID, Objective ID   ?
???????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Get Quest Subsystem     ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Get Quest Asset (Quest ID)              ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Set Text (TextQuestTitle)             ?
? Text: [Quest Asset ? Quest Name]          ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Get Objective Progress             ?
? Quest ID, Objective ID   ?
? Outputs: Current Count, Target Count    ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Format Text         ?
? "{0} ({1}/{2})"        ?
? 0 = Objective Title       ?
? 1 = Current Count            ?
? 2 = Target Count          ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Set Text (TextObjective)          ?
? Text: [Formatted Text]   ?
?????????????????????????????????????????????????
```

---

### Вариант B: Quest Dialog (NPC interaction)

#### Шаг 4.4: Создать Quest Dialog Widget

1. **Content Browser** ? `Content/Game/UI/Quests`
2. **Right Click ? User Interface ? Widget Blueprint**
3. Назовите: `WBP_QuestDialog`

---

#### Шаг 4.5: Дизайн Quest Dialog

```
Canvas Panel
  ?? Vertical Box (Center)
      ?? Text Block (NPC Name)
      ?   ?? Text: "Староста"
      ?
      ?? Scroll Box (Quest List)
   ?   ?? (Динамически создаваемые квесты)
      ?
      ?? Horizontal Box (Buttons)
          ?? Button (Accept)
          ?   ?? Text: "Принять"
          ?? Button (Close)
  ?? Text: "Закрыть"
```

---

#### Шаг 4.6: Blueprint логика Quest Dialog

```
???????????????????????????????????????????????????
? EVENT: On Dialog Opened       ?
? Input: NPC Reference      ?
???????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Get Component (Quest Giver Component)   ?
? From: NPC Reference          ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Get Available Quests For Player         ?
? Player: Get Player Controller      ?
?????????????????????????????????????????????????
    ?
  ?
?????????????????????????????????????????????????
? For Each Loop (Quest Array)            ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Create Widget (WBP_QuestListItem)            ?
? Quest Asset: [Loop Body]      ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Add to Scroll Box           ?
?????????????????????????????????????????????????
```

**Button Accept ? On Clicked**:

```
???????????????????????????????????????????????????
? EVENT: On Accept Button Clicked     ?
???????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Get Quest Subsystem   ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Start Quest (Quest Blueprint Library)        ?
? Quest ID: [Selected Quest ID]         ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Remove from Parent (Close Dialog)?
?????????????????????????????????????????????????
```

---

## 5?? Тестирование

### Шаг 5.1: Поместить NPC в уровень

1. Откройте ваш уровень
2. Перетащите `BP_Elder` из Content Browser в уровень
3. Разместите где игрок сможет подойти

---

### Шаг 5.2: Добавить Quest Tracker на HUD

В вашем **HUD Widget** или **Player Controller**:

```
???????????????????????????????????????????????????
? EVENT: Begin Play (Player Controller)        ?
???????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Create Widget (WBP_QuestTracker)        ?
?????????????????????????????????????????????????
    ?
    ?
?????????????????????????????????????????????????
? Add to Viewport          ?
? Z-Order: 10      ?
?????????????????????????????????????????????????
```

---

### Шаг 5.3: Тест в игре

1. **Play in Editor (Alt+P)**
2. Подойдите к NPC `BP_Elder`
3. Должна появиться иконка "!" над головой
4. Нажмите **E** для взаимодействия
5. Откроется диалог с квестом
6. Нажмите **"Принять"**
7. Quest Tracker должен обновиться
8. Снова поговорите с NPC (запустите диалог)
9. **Quest Event** "NpcTalked" сработает
10. Квест завершится! ?

---

## 6?? FAQ и решение проблем

### ? Проблема: "Квест не загружается!"

**Решение**:
1. Проверьте **Asset Manager** настроен (Шаг 1.2)
2. Проверьте путь `/Game/Quests` правильный
3. **Перезапустите редактор**

---

### ? Проблема: "Квест не появляется у NPC!"

**Решение**:
1. Проверьте `NPC ID` в Quest Giver Component = `Quest Giver ID` в квесте
2. Проверьте квест добавлен в `Available Quests`
3. Проверьте квест НЕ уже завершён (если не повторяемый)

---

### ? Проблема: "Квест не засчитывается!"

**Решение**:
1. **Проверьте** узел `Emit NPC Talked` добавлен в диалог!
2. Проверьте `NPC ID` в событии совпадает с условием в квесте
3. Включите **Output Log** ? должно быть:
   ```
   LogTemp: QuestProgressManager: Objective 'Obj_TalkToElder' completed
   ```

---

### ? Проблема: "UI не обновляется!"

**Решение**:
1. Проверьте событие `On Objective Updated` привязано
2. Проверьте `Get Progress Manager` возвращает не null
3. Добавьте `Print String` для отладки

---

### ?? Полезные Blueprint узлы

| Узел | Где найти | Для чего |
|------|-----------|----------|
| **Get Quest Subsystem** | Quest Blueprint Library | Получить систему квестов |
| **Start Quest** | Quest Blueprint Library | Запустить квест |
| **Get Active Quests** | Quest Blueprint Library | Получить активные квесты |
| **Emit NPC Talked** | Quest ? Events | Отправить событие "поговорил с NPC" |
| **Get Quest Asset** | Quest Blueprint Library | Получить данные квеста |
| **Get Objective Progress** | Quest Blueprint Library | Прогресс цели (0/1, 5/10, и т.д.) |

---

## ?? Дополнительные примеры

### Пример 1: Квест "Собрать яблоки"

**Objective Condition**:
```
Type: ItemAcquired
String Param: Apple
Int Param: 5
Comparison: GreaterOrEqual
```

**Как активировать** (в вашем инвентаре):
```
When Item Added:
  ?? Emit Item Acquired
      ?? Item ID: Apple
      ?? Count: [Added Count]
      ?? Player: Self
```

---

### Пример 2: Квест "Убить 10 волков"

**Objective Condition**:
```
Type: ActorKilled
String Param: Wolf
Int Param: 10
Comparison: GreaterOrEqual
```

**Как активировать** (в BP_Wolf):
```
Event On Death:
  ?? Emit Actor Killed
      ?? Victim: Self
      ?? Killer: [DamageInstigator]
      ?? Tags: Enemy.Wolf
```

---

### Пример 3: Квест "Дойти до места"

**Objective Condition**:
```
Type: EnterArea
String Param: SecretCave
Int Param: 1
Comparison: GreaterOrEqual
```

**Как активировать** (в Trigger Box):
```
Event On Actor Begin Overlap:
  ?? Emit Enter Area
      ?? Area ID: SecretCave
      ?? Actor: [Overlapping Actor]
  ?? Tags: [Empty]
```

---

## ?? Заключение

**Поздравляю!** Вы создали свой первый квест! ??

**Что дальше**:
1. Попробуйте создать квест с несколькими целями
2. Добавьте визуальные награды (предметы)
3. Создайте цепочку квестов (Phase ? Next Phase)
4. Интегрируйте с вашей системой инвентаря

---

**Документация**:
- `QuickStart.md` - Быстрый старт
- `Examples.md` - Больше примеров
- `API_Reference.md` - Полный справочник

**Нужна помощь?** Проверьте `Output Log` в редакторе для диагностики!

---

**Quest System v2.0 - Ready for your adventure!** ?
