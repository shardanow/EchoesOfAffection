# Visual Guide: Road Navigation Setup

## ?? Пошаговые скриншоты настройки

### Шаг 1: Создание Navigation Query Filter

#### 1.1 Создание Data Asset

```
Content Browser
??? Right-click
 ??? Miscellaneous
    ??? Data Asset
      ??? NavigationQueryFilter ? Выбрать
```

**Скриншот:**
```
??????????????????????????????????????
? Pick Data Asset Class        ?
??????????????????????????????????????
? ?? Search: navigation            ?
?          ?
? ? NavigationData     ?
? ? NavigationQueryFilter ? ЭТО!   ?
? ? NavigationSystem       ?
??????????????????????????????????????
```

**Имя:** `NQF_RoadOnly`

---

#### 1.2 Настройка Areas

**Откройте** `NQF_RoadOnly`

**Details Panel:**

```
?? NavigationQueryFilter ?????????????
?           ?
? ? Areas [2]      ?
?   ?? [0] ????????????????????????  ?
?   ? Area Class: NavArea_Road    ?  ?
?   ? ? Override Travel Cost      ?  ?
?   ?   Travel Cost: 0.5        ?  ?
?   ? ? Override Entering Cost    ??
?   ? ? Is Excluded        ?  ?
?   ???????????????????????????????  ?
?       ?
?   ?? [1] ????????????????????????  ?
?   ? Area Class: NavArea_Default ?  ?
?   ? ? Override Travel Cost      ?  ?
?   ?   Travel Cost: 100.0        ?  ?
? ? ? Override Entering Cost    ?  ?
?   ? ? Is Excluded    ?  ?
?   ???????????????????????????????  ?
?           ?
? [+ Add]    ?
??????????????????????????????????????
```

**Значения:**
- `NavArea_Road`: **0.5** (дешево - AI предпочитает)
- `NavArea_Default`: **100.0** (дорого - AI избегает)

---

### Шаг 2: Разметка дорог в уровне

#### 2.1 Добавление Nav Modifier Volume

**Place Actors Panel:**

```
?? Place Actors ??????????????????????
? ?? Search: nav modifier            ?
?           ?
? ? Volumes    ?
?   ? Blocking Volume     ?
?   ? Cull Distance Volume    ?
?   ? Nav Modifier Volume ? ЭТО!   ?
?   ? Pain Causing Volume ?
??????????????????????????????????????
```

**Перетащите** на уровень над дорогой.

---

#### 2.2 Размещение Volume

**Viewport (сверху):**

```
   ?????????????????????
      ?   Nav Modifier    ? ? Растяните чтобы покрыть дорогу
        ?     Volume        ?
     ?????????????????????
  ДОРОГА
????????????????????????????????? ? Дорога должна быть внутри Volume
    
        
  ??    ТРАВА    ??    ? Трава НЕ покрыта Volume
```

**Масштабирование:**
- **X/Y**: Ширина и длина дороги
- **Z**: Высота 100-200 (чтобы покрыть персонажей)

---

#### 2.3 Настройка Area Class

**Details Panel (Nav Modifier Volume):**

```
?? Nav Modifier Volume ???????????????
?            ?
? ? Navigation      ?
?   Area Class: NavArea_Road ? ЭТО! ?
?       ?
? ? Override         ?
? ? Project to Terrain       ?
??????????????????????????????????????
```

**Важно:** Установите `Area Class` в **NavArea_Road**

---

#### 2.4 Пересборка NavMesh

**Меню:** `Build ? Build Paths`

Или просто подвиньте Volume - NavMesh пересоберется автоматически.

---

### Шаг 3: Настройка MoveToLocation Action

#### 3.1 Открытие Schedule Entry

**Content Browser:**

```
Content
??? Schedules
    ??? Entries
    ??? DA_Entry_GoToWork ? Откройте
```

---

#### 3.2 Настройка Action

**Details Panel (Schedule Entry):**

```
?? Schedule Entry Data ???????????????
?     ?
? ? Action  ?
?   Action Type: MoveToLocation    ?
?     ?
?   ? Movement        ?
?     Acceptance Radius: 100.0       ?
?  ? Use Pathfinding   ?
?     ? Stop On Overlap              ?
?  ? Accept Partial Path     ?
?     Speed Multiplier: 1.0   ?
?     Filter Class: NQF_RoadOnly ?!  ?  ? ЗДЕСЬ!
?      ?
?   ? Location             ?
?     Location Selector: ActorTag    ?
?       Required Tags: Location.Work ?
?       Selection Mode: Closest      ?
??????????????????????????????????????
```

**Критично:** `Filter Class` должен быть `NQF_RoadOnly`!

---

### Шаг 4: Визуальная проверка

#### 4.1 Отображение NavMesh

**В PIE (Play In Editor):**

1. Нажмите **P** на клавиатуре
2. NavMesh появится цветными зонами

**Ожидаемый результат:**

```
Вид сверху:

    ??      ??      ??      ??
  [?? Трава ??][?? Трава ??]
  
???[?? Дорога ??]??? ? Желтая зона (NavArea_Road)
  
  [?? Трава ??][?? Трава ??]
    ??      ??      ??      ??
```

**Цвета:**
- ?? **Желтый** = NavArea_Road (дорога) - **ПРАВИЛЬНО!**
- ?? **Синий** = NavArea_Default (трава)
- ?? **Зеленый** = NavArea_Grass (если создали)

---

#### 4.2 Проверка пути NPC

**Включите AI Debug:**

Console: `showdebug AI` или `ai.debug.nav.show 1`

**Путь NPC:**

```
     NPC ??
  ?
      ?  Красная линия = путь AI
[?? Дорога ??]???????? ?? Цель
      
      
Неправильно:
     NPC ??
      ?
      ?  Прямая линия через траву
  [?? Трава ??]???????? ?? Цель  ?
```

**Правильный путь:**
- Линия идет **ТОЛЬКО по желтым зонам**
- Обходит синие зоны стороной

---

### Шаг 5: Blueprint пример (опционально)

#### Создание NavArea_Road в Blueprint

**1. Создайте Blueprint:**

```
Content Browser
??? Right-click
    ??? Blueprint Class
        ??? Nav Area ? Выбрать
```

**Имя:** `BP_NavArea_Road`

---

**2. Настройте свойства:**

```
?? BP_NavArea_Road ???????????????????
?           ?
? ? Area Properties    ?
?   Default Cost: 1.0        ?
?   Fixed Entering Cost: 0.0         ?
?   Draw Color: (R=255, G=255, B=0)  ? ? Желтый
?   ? Is Meta Area         ?
?   Area Flags: 0   ?
??????????????????????????????????????
```

---

## ?? Troubleshooting визуально

### Проблема: NPC идет напрямик

**Проверка 1: Filter Class установлен?**

```
MoveToLocation Action
??? Filter Class: [None] ? ? НЕПРАВИЛЬНО!

Должно быть:
MoveToLocation Action
??? Filter Class: NQF_RoadOnly ?
```

---

**Проверка 2: NavMesh правильного цвета?**

```
Нажмите P:

Неправильно:
???[?? Дорога ??]??? ? ? Дорога синяя

Правильно:
???[?? Дорога ??]??? ? ? Дорога желтая
```

**Решение:** Проверьте Area Class в Nav Modifier Volume.

---

**Проверка 3: bUsePathfinding включен?**

```
MoveToLocation Action
??? Use Pathfinding: ? ? ? НЕПРАВИЛЬНО!

Должно быть:
MoveToLocation Action
??? Use Pathfinding: ? ?
```

---

## ?? Layout примеры

### Простая прямая дорога

```
Вид сверху:

?? Дом         [?? Дорога ??]  ?? Офис
   ?        ?
????????????? 500m ??????????????????
   
Nav Modifier Volume: 500m x 5m x 2m
```

---

### Перекресток

```
      [??]
        ?
         ?
       [??]???[?? ?? ??]???[??]
       ?
        ?
      [??]

Используйте 2 Nav Modifier Volumes:
- Горизонтальная дорога: 1 Volume
- Вертикальная дорога: 1 Volume
```

---

### Город с тротуарами

```
??????[?? Тротуар ??]????
         [?? Дорога ??]
??????[?? Тротуар ??]????

Фильтр:
- NavArea_Road (??): 0.5
- NavArea_Sidewalk (??): 0.7
- NavArea_Building (??): IsExcluded = true
```

---

## ? Checklist финальной проверки

Перед запуском игры убедитесь:

- [ ] Navigation Query Filter создан (`NQF_RoadOnly`)
- [ ] Areas настроены (Road = 0.5, Default = 100.0)
- [ ] Nav Modifier Volumes размещены над дорогами
- [ ] Area Class = `NavArea_Road` в каждом Volume
- [ ] NavMesh пересобран (Build ? Build Paths)
- [ ] `Filter Class` установлен в MoveToLocation
- [ ] `bUsePathfinding = true` в MoveToLocation
- [ ] В PIE при нажатии P дорога **желтая** ??
- [ ] NPC идет по дороге, не срезая ????????

---

**Все галочки стоят? Готово! ??**

Смотрите также:
- [Полное руководство (RU)](ROAD_NAVIGATION_RU.md)
- [Быстрый старт (RU)](ROAD_QUICK_START_RU.md)
