# Interaction System - Architecture Diagrams

## System Architecture

```
???????????????????????????????????????????????????????????????????
?                        GAME WORLD                                ?
?                                                                   ?
?  ??????????????????????????????   ????????????????????????????  ?
?  ?   Player Character          ?   ?   Interactable Objects   ?  ?
?  ?                             ?   ?                          ?  ?
?  ?  ????????????????????????  ?   ?  ????????????????????   ?  ?
?  ?  ? InteractionComponent ??????????? Door Actor       ?   ?  ?
?  ?  ?                      ?  ?   ?  ? Implements:      ?   ?  ?
?  ?  ? - Trace & Detect     ?  ?   ?  ? IInteractable-   ?   ?  ?
?  ?  ? - Focus Management   ?  ?   ?  ? Interface        ?   ?  ?
?  ?  ? - Start/End Interact ?  ?   ?  ????????????????????   ?  ?
?  ?  ? - Delegates          ?  ?   ?                          ?  ?
?  ?  ????????????????????????  ?   ?  ????????????????????   ?  ?
?  ?                             ?   ?  ? NPC Actor        ?   ?  ?
?  ???????????????????????????????   ?  ? Implements:      ?   ?  ?
?                                     ?  ? IInteractable-   ?   ?  ?
?  ???????????????????????????????   ?  ? Interface        ?   ?  ?
?  ?   AI Character               ?   ?  ????????????????????   ?  ?
?  ?                              ?   ?                          ?  ?
?  ?  ????????????????????????   ?   ?  ????????????????????   ?  ?
?  ?  ? InteractionComponent ?   ?   ?  ? Pickup Actor     ?   ?  ?
?  ?  ????????????????????????   ?   ?  ? Implements:      ?   ?  ?
?  ?                              ?   ?  ? IInteractable-   ?   ?  ?
?  ????????????????????????????????   ?  ? Interface        ?   ?  ?
?                                      ?  ????????????????????   ?  ?
?                                      ?                          ?  ?
?                                      ?  ????????????????????   ?  ?
?                                      ?  ? Custom Actor     ?   ?  ?
?                                      ?  ? + Interactable-  ?   ?  ?
?                                      ?  ?   Component      ?   ?  ?
?                                      ?  ????????????????????   ?  ?
?                                      ????????????????????????????  ?
?????????????????????????????????????????????????????????????????????
```

## Interaction Flow

```
???????????????                                      ???????????????
?   Player    ?                                      ? Interactable?
?  Character  ?                                      ?   Object    ?
???????????????                                      ???????????????
       ?                                                    ?
       ? 1. Tick / Trace Detection                         ?
       ??????????????????????????????????????????????????  ?
       ?                                                    ?
       ? 2. CanInteract Check                              ?
       ??????????????????????????????????????????????????  ?
       ?                                                    ?
       ? 3. OnInteractionFocused (Highlight)               ?
       ?????????????????????????????????????????????????   ?
       ?                                                    ?
       ? 4. Player Presses Interact Button                 ?
       ?                                                    ?
       ? 5. TryInteract()                                  ?
       ??????????????????????????????????????????????????  ?
       ?                                                    ?
       ? 6. BeginInteract()                                ?
       ??????????????????????????????????????????????????  ?
       ?                                                    ?
       ? 7. OnInteractionStarted Delegate                  ?
       ?????????????????????????????????????????????????   ?
       ?                                                    ?
       ? 8. [For Duration-Based] Wait...                   ?
       ?                                                    ?
       ? 9. EndInteract() / CompleteInteraction()          ?
       ??????????????????????????????????????????????????  ?
       ?                                                    ?
       ? 10. OnInteractionCompleted Delegate               ?
       ?????????????????????????????????????????????????   ?
       ?                                                    ?
       ? 11. OnInteractionUnfocused (Remove Highlight)     ?
       ?????????????????????????????????????????????????   ?
       ?                                                    ?
```

## Class Relationships

```
                   ?????????????????????????
                   ? IInteractableInterface?
                   ?  (Blueprint Interface)?
                   ?????????????????????????
                               ?
                               ? implements
                               ?
          ???????????????????????????????????????????
          ?                    ?                    ?
          ?                    ?                    ?
??????????????????????  ???????????????????  ?????????????????????
? APickupableActor   ?  ? ADoorActor      ?  ? ANPCActor         ?
?                    ?  ?                 ?  ?                   ?
? - ItemName         ?  ? - bIsOpen       ?  ? - NPCName         ?
? - PerformPickup()  ?  ? - OpenDoor()    ?  ? - StartDialogue() ?
??????????????????????  ???????????????????  ?????????????????????


                   ??????????????????????????
                   ? UInteractableComponent ?
                   ?  (ActorComponent)      ?
                   ??????????????????????????
                               ?
                               ? implements
                               ?
                   ?????????????????????????
                   ? IInteractableInterface?
                   ?????????????????????????
                               
            Used by any Actor for quick setup


????????????????????????????????????????????????????????????????
?               UInteractionComponent                           ?
?              (ActorComponent)                                 ?
?                                                               ?
?  Properties:                                                  ?
?  - TraceDistance                                              ?
?  - TraceRadius                                                ?
?  - bInteractionEnabled                                        ?
?  - FocusedActor                                               ?
?  - InteractingActor                                           ?
?                                                               ?
?  Methods:                                                     ?
?  - FindInteractables()                                        ?
?  - TryInteract() ? EInteractionResult                         ?
?  - CancelInteraction()                                        ?
?  - GetInteractionProgress() ? float                           ?
?                                                               ?
?  Delegates:                                                   ?
?  - OnInteractionStarted(Actor, Data)                          ?
?  - OnInteractionCompleted(Actor)                              ?
?  - OnInteractionCancelled(Actor)                              ?
?  - OnInteractableFocused(Actor, Data)                         ?
?  - OnInteractableUnfocused(Actor)                             ?
?????????????????????????????????????????????????????????????????
```

## Data Structures

```
??????????????????????????????????????????????????????????
?              FInteractionData (Struct)                  ?
??????????????????????????????????????????????????????????
? + InteractionName: FText                               ?
? + InteractionType: EInteractionType                    ?
? + ActionText: FText                                    ?
? + InteractionDuration: float                           ?
? + MaxInteractionDistance: float                        ?
? + bCanInteractMultipleTimes: bool                      ?
? + bRequiresLineOfSight: bool                           ?
? + InteractionPriority: int32                           ?
??????????????????????????????????????????????????????????

??????????????????????????????????????????????????????????
?          EInteractionType (Enum)                        ?
??????????????????????????????????????????????????????????
? Х None                                                 ?
? Х Pickup        - ѕодобрать предмет                    ?
? Х Examine       - ќсмотреть объект                     ?
? Х Talk          - ѕоговорить с NPC                     ?
? Х Open          - ќткрыть дверь/сундук                 ?
? Х Close         - «акрыть                              ?
? Х Toggle        - ѕереключить                          ?
? Х Use           - »спользовать (общее)                 ?
? Х Activate      - јктивировать механизм                ?
? Х Custom        -  астомный тип                        ?
??????????????????????????????????????????????????????????

??????????????????????????????????????????????????????????
?         EInteractionResult (Enum)                       ?
??????????????????????????????????????????????????????????
? Х Success              - ”спешно                       ?
? Х Failed               - ѕровалено                     ?
? Х TooFar               - —лишком далеко                ?
? Х NoLineOfSight        - Ќет пр€мой видимости          ?
? Х AlreadyInteracting   - ”же взаимодействует           ?
? Х NotInteractable      - Ќе интерактивный              ?
? Х RequirementsNotMet   - “ребовани€ не выполнены       ?
??????????????????????????????????????????????????????????
```

## Implementation Approaches Comparison

```
????????????????????????????????????????????????????????????????????
?              APPROACH 1: Interface Only                           ?
????????????????????????????????????????????????????????????????????
?                                                                   ?
?  AActor + IInteractableInterface                                 ?
?                                                                   ?
?  ? Full control over implementation                              ?
?  ? Lightweight - no extra components                            ?
?  ? Best for unique, complex interactions                        ?
?  ? More C++ code required                                       ?
?  ? Less Blueprint-friendly                                      ?
?                                                                   ?
?  Example: APickupableActor, ADoorActor, ANPCActor               ?
????????????????????????????????????????????????????????????????????

????????????????????????????????????????????????????????????????????
?            APPROACH 2: Component-Based                            ?
????????????????????????????????????????????????????????????????????
?                                                                   ?
?  AActor + UInteractableComponent                                 ?
?                                                                   ?
?  ? Blueprint-friendly                                            ?
?  ? Fast prototyping                                             ?
?  ? No C++ needed                                                ?
?  ? Built-in highlighting                                        ?
?  ? Slightly less flexible                                       ?
?  ? Extra component overhead                                     ?
?                                                                   ?
?  Example: Any Blueprint Actor with component attached            ?
????????????????????????????????????????????????????????????????????

????????????????????????????????????????????????????????????????????
?              APPROACH 3: Hybrid                                   ?
????????????????????????????????????????????????????????????????????
?                                                                   ?
?  AActor + IInteractableInterface + UInteractableComponent        ?
?                                                                   ?
?  ? Best of both worlds                                          ?
?  ? C++ control + Blueprint events                               ?
?  ? Reusable base functionality                                  ?
?  ? Most complex setup                                           ?
?                                                                   ?
?  Example: Complex actors needing both approaches                 ?
????????????????????????????????????????????????????????????????????
```

## Extension Points

```
                    ????????????????????????
                    ?  BASE SYSTEM         ?
                    ?                      ?
                    ? InteractionTypes     ?
                    ? IInteractableInterface?
                    ? InteractionComponent ?
                    ? InteractableComponent?
                    ????????????????????????
                               ?
        ???????????????????????????????????????????????
        ?                      ?                      ?
??????????????????   ????????????????????   ??????????????????
? ADD NEW TYPES  ?   ? ADD REQUIREMENTS ?   ? ADD UI/EFFECTS ?
?                ?   ?                  ?   ?                ?
? Х Craft        ?   ? Х Item Required  ?   ? Х Progress Bar ?
? Х Repair       ?   ? Х Level Check    ?   ? Х Particles    ?
? Х Trade        ?   ? Х Quest State    ?   ? Х Sounds       ?
? Х Hack         ?   ? Х Permission     ?   ? Х Animations   ?
??????????????????   ????????????????????   ??????????????????
```

## Best Practices Decision Tree

```
                    START
                      ?
                      ?
         ???????????????????????????
         ? Blueprint-only project? ?
         ???????????????????????????
                  ?
         Yes ??????????? No
          ?               ?
          ?               ?
????????????????????  ????????????????????
? Use Component    ?  ? Complex logic?   ?
? UInteractable-   ?  ????????????????????
? Component        ?           ?
????????????????????  Yes ??????????? No
                       ?               ?
                       ?               ?
              ???????????????????  ????????????????
              ? Inherit from    ?  ? Use Component?
              ? Example actors  ?  ? OR Interface ?
              ? (Door/NPC/      ?  ? (both work)  ?
              ?  Pickup)        ?  ????????????????
              ???????????????????
```

## Performance Considerations

```
????????????????????????????????????????????????????????????????
?                    OPTIMIZATION TIPS                          ?
????????????????????????????????????????????????????????????????
?                                                               ?
? 1. TraceTickInterval (default 0.1s)                          ?
?    Х 0.05s = More responsive, higher CPU cost                ?
?    Х 0.1s  = Balanced (recommended)                          ?
?    Х 0.2s  = Less responsive, lower CPU cost                 ?
?                                                               ?
? 2. Trace Type                                                ?
?    Х Line Trace (Radius = 0): More precise, cheaper         ?
?    Х Sphere Trace (Radius > 0): Easier to use, more expensive?
?                                                               ?
? 3. Focus Management                                          ?
?    Х Only one focused object per InteractionComponent        ?
?    Х Highlight updates only on focus change                  ?
?                                                               ?
? 4. Distance Culling                                          ?
?    Х Set appropriate MaxInteractionDistance per object       ?
?    Х Lower distances = better performance                    ?
?                                                               ?
? 5. Collision Channels                                        ?
?    Х Use custom channel for interactions                     ?
?    Х Reduces collision checks                                ?
?                                                               ?
?????????????????????????????????????????????????????????????????
```

## Event Flow Timeline

```
Time ?
?
?? Tick (TraceTickInterval)
?   ?? FindInteractables()
?       ?? Trace ? Hit Detection
?           ?? IsActorInteractable() ? CanInteract()
?               ?? Yes: UpdateFocusedInteractable()
?               ?       ?? OnInteractionUnfocused (old)
?               ?       ?? OnInteractionFocused (new)
?               ?? No: Clear focus
?
?? Input: Interact Button Pressed
?   ?? TryInteract()
?       ?? ValidateInteraction()
?           ?? Distance OK?
?           ?? Line of Sight OK?
?           ?? BeginInteract()
?               ?? Duration = 0: Instant
?               ?   ?? EndInteract() ? OnInteractionCompleted
?               ?? Duration > 0: Start Timer
?
?? Tick (while interacting)
?   ?? CurrentInteractionTime += DeltaTime
?       ?? If >= Duration:
?           ?? CompleteInteraction()
?               ?? EndInteract() ? OnInteractionCompleted
?
?? Input: Cancel / Move Away
    ?? CancelInteraction()
        ?? CancelInteract() ? OnInteractionCancelled
```
